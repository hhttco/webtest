<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>æ˜Ÿé™…è¿œå¾ï¼šä¸‰ä½ä¸€ä½“</title>
    <style>
        :root { --neon: #00f2ff; --bg: #050810; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Arial', sans-serif; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        /* é¡¶éƒ¨å¸ƒå±€ï¼šå·¦è›‡å³æœº */
        #topZone { display: flex; height: 50vh; border-bottom: 2px solid var(--neon); }
        .canvas-container { flex: 1; position: relative; border: 1px solid #111; }
        canvas { width: 100%; height: 100%; display: block; }

        /* åº•éƒ¨è¿è¿çœ‹ï¼šå¼¹è¯åŠ å·¥å‚ */
        #matchZone { 
            flex: 1; background: #0a0e1a; display: grid; 
            grid-template-columns: repeat(8, 1fr); gap: 4px; padding: 10px; 
            overflow-y: auto;
        }
        .cell { 
            background: #16213e; border: 1px solid #0f3460; display: flex; 
            justify-content: center; align-items: center; font-size: 20px; 
            aspect-ratio: 1; cursor: pointer; border-radius: 4px; 
        }
        .cell.selected { background: var(--neon); color: #000; box-shadow: 0 0 10px var(--neon); }
        .cell.hidden { opacity: 0; pointer-events: none; }

        .label { position: absolute; top: 5px; left: 5px; font-size: 12px; color: var(--neon); background: rgba(0,0,0,0.7); padding: 2px 6px; }
        #startBtn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 15px 40px; font-size: 20px; background: var(--neon); border: none; border-radius: 30px; cursor: pointer; z-index: 100; font-weight: bold; }
    </style>
</head>
<body>
    <button id="startBtn">å¼€å§‹åŒæ­¥å®éªŒ</button>
    <div id="topZone">
        <div class="canvas-container">
            <div class="label">èµ„æºæ”¶é›† (WASDæ§åˆ¶è›‡)</div>
            <canvas id="sCanvas"></canvas>
        </div>
        <div class="canvas-container">
            <div class="label">è‡ªåŠ¨é˜²å« (é¼ æ ‡/è§¦æ‘¸æ§åˆ¶ä½ç§»)</div>
            <canvas id="pCanvas"></canvas>
        </div>
    </div>
    <div id="matchZone"></div>

    <script>
        const sCanvas = document.getElementById('sCanvas'), pCanvas = document.getElementById('pCanvas');
        const sCtx = sCanvas.getContext('2d'), pCtx = pCanvas.getContext('2d');
        const matchZone = document.getElementById('matchZone'), startBtn = document.getElementById('startBtn');

        // åˆå§‹åŒ–å°ºå¯¸ [MDN Canvas é€‚é…](https://developer.mozilla.org)
        function initSize() {
            sCanvas.width = pCanvas.width = window.innerWidth / 2;
            sCanvas.height = pCanvas.height = window.innerHeight * 0.5;
        }
        window.onresize = initSize; initSize();

        let gameActive = false, ammoPool = [];
        let snake = [{x:10, y:10}], food = {x:5, y:5}, sDir = {x:1, y:0};
        let planeX = 50, bullets = [], enemies = [], firePower = 0;
        let selected = null;
        const icons = ['ğŸ”‹', 'ğŸš€', 'âš¡', 'ğŸ’', 'ğŸ”¥'];

        // --- æ ¸å¿ƒï¼šè›‡åƒè±†äº§ç”Ÿè¿è¿çœ‹æ–¹å— ---
        function updateSnake() {
            const head = {x: snake[0].x + sDir.x, y: snake[0].y + sDir.y};
            if(head.x<0 || head.x>=20 || head.y<0 || head.y>=20) return; // ç®€åŒ–çš„æ’å¢™ä¸æ‰§è¡Œ
            snake.unshift(head);
            if(head.x === food.x && head.y === food.y) {
                food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
                createAmmoPair(); 
            } else { snake.pop(); }
        }

        function createAmmoPair() {
            const icon = icons[Math.floor(Math.random()*icons.length)];
            [1, 2].forEach(() => {
                const cell = document.createElement('div');
                cell.className = 'cell'; cell.innerText = icon;
                const item = { icon, el: cell, id: Math.random() };
                cell.onclick = () => handleMatch(item);
                matchZone.appendChild(cell);
                ammoPool.push(item);
            });
        }

        // --- æ ¸å¿ƒï¼šæ¶ˆé™¤å¢åŠ é£æœºç«åŠ› ---
        function handleMatch(item) {
            if(!selected) {
                selected = item; item.el.classList.add('selected');
            } else {
                if(selected.id !== item.id && selected.icon === item.icon) {
                    item.el.classList.add('hidden'); selected.el.classList.add('hidden');
                    firePower += 50; // å¢åŠ ç«åŠ›ç‚¹
                }
                selected.el.classList.remove('selected'); selected = null;
            }
        }

        function gameLoop() {
            if(!gameActive) return;
            // 1. ç»˜åˆ¶è›‡ (èµ„æºåŒº)
            sCtx.fillStyle = '#000'; sCtx.fillRect(0,0,sCanvas.width, sCanvas.height);
            sCtx.fillStyle = '#2ecc71';
            snake.forEach(p => sCtx.fillRect(p.x*sCanvas.width/20, p.y*sCanvas.height/20, sCanvas.width/20-1, sCanvas.height/20-1));
            sCtx.fillStyle = 'red'; sCtx.fillRect(food.x*sCanvas.width/20, food.y*sCanvas.height/20, sCanvas.width/20, sCanvas.height/20);

            // 2. ç»˜åˆ¶é£æœº (æˆ˜æ–—åŒº)
            pCtx.fillStyle = 'rgba(0,0,0,0.2)'; pCtx.fillRect(0,0,pCanvas.width, pCanvas.height);
            pCtx.fillStyle = '#00f2ff'; pCtx.beginPath();
            pCtx.moveTo(planeX, pCanvas.height-20); pCtx.lineTo(planeX+20, pCanvas.height-50); pCtx.lineTo(planeX+40, pCanvas.height-20); pCtx.fill();

            // è‡ªåŠ¨å°„å‡»ï¼šæ¶ˆè€—ç«åŠ›å€¼
            if(firePower > 0) {
                bullets.push({x: planeX+18, y: pCanvas.height-50});
                firePower--;
            }

            bullets.forEach((b, i) => {
                b.y -= 10; pCtx.fillStyle = '#fffb00'; pCtx.fillRect(b.x, b.y, 4, 10);
                if(b.y < 0) bullets.splice(i, 1);
            });

            if(Math.random() < 0.05) enemies.push({x: Math.random()*pCanvas.width, y: -20});
            enemies.forEach((e, i) => {
                e.y += 3; pCtx.fillStyle = '#666'; pCtx.beginPath(); pCtx.arc(e.x, e.y, 15, 0, Math.PI*2); pCtx.fill();
                bullets.forEach((b, bi) => {
                    if(Math.abs(b.x-e.x)<20 && Math.abs(b.y-e.y)<20) { enemies.splice(i, 1); bullets.splice(bi, 1); }
                });
            });

            requestAnimationFrame(gameLoop);
        }

        // æ§åˆ¶å™¨
        window.addEventListener('keydown', e => {
            if(e.key==='w') sDir={x:0, y:-1}; if(e.key==='s') sDir={x:0, y:1};
            if(e.key==='a') sDir={x:-1, y:0}; if(e.key==='d') sDir={x:1, y:0};
        });
        pCanvas.addEventListener('mousemove', e => planeX = e.clientX - pCanvas.offsetLeft - 20);
        pCanvas.addEventListener('touchmove', e => { e.preventDefault(); planeX = e.touches[0].clientX - pCanvas.offsetLeft - 20; }, {passive:false});

        startBtn.onclick = () => {
            startBtn.style.display = 'none'; gameActive = true;
            setInterval(updateSnake, 150); // è›‡é€Ÿå›ºå®š
            gameLoop();
        };
    </script>
</body>
</html>
